{
  "Resources": {
    "appsg42805CE6": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "aria-canary-Ingre-alb8A-FCLO2ZJVWR6C/app-sg",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1"
          }
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "allow SSH access from anywhere",
            "FromPort": 22,
            "IpProtocol": "tcp",
            "ToPort": 22
          },
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "allow node_exporter access from anywhere",
            "FromPort": 9100,
            "IpProtocol": "tcp",
            "ToPort": 9100
          },
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "allow all http access",
            "FromPort": 80,
            "IpProtocol": "tcp",
            "ToPort": 80
          }
        ],
        "VpcId": "vpc-03a574519fc5c939d"
      }
    },
    "asgBaselineInstanceRoleBAFF0850": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": {
                  "Fn::Join": [
                    "",
                    [
                      "ec2.",
                      {
                        "Ref": "AWS::URLSuffix"
                      }
                    ]
                  ]
                }
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Tags": [
          {
            "Key": "Name",
            "Value": "aria-canary-Ingre-alb8A-FCLO2ZJVWR6C/asgBaseline"
          }
        ]
      }
    },
    "asgBaselineInstanceRoleDefaultPolicyD58F3F8B": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":s3:::",
                      {
                        "Ref": "AssetParameters26270f87e4fba3388d4696223702390563a99b004ab38f55dba9f8cec53621c2S3Bucket396A38A3"
                      }
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":s3:::",
                      {
                        "Ref": "AssetParameters26270f87e4fba3388d4696223702390563a99b004ab38f55dba9f8cec53621c2S3Bucket396A38A3"
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":s3:::",
                      {
                        "Ref": "AssetParametersd305dd11fd7f4cefbe4a1b6f8810fdc286483193cf7ef403efe1a4e5dda5846eS3Bucket7C54371C"
                      }
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":s3:::",
                      {
                        "Ref": "AssetParametersd305dd11fd7f4cefbe4a1b6f8810fdc286483193cf7ef403efe1a4e5dda5846eS3Bucket7C54371C"
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "asgBaselineInstanceRoleDefaultPolicyD58F3F8B",
        "Roles": [
          {
            "Ref": "asgBaselineInstanceRoleBAFF0850"
          }
        ]
      }
    },
    "asgBaselineInstanceProfile5B3EB932": {
      "Type": "AWS::IAM::InstanceProfile",
      "Properties": {
        "Roles": [
          {
            "Ref": "asgBaselineInstanceRoleBAFF0850"
          }
        ]
      }
    },
    "asgBaselineLaunchConfig3384BBEF": {
      "Type": "AWS::AutoScaling::LaunchConfiguration",
      "Properties": {
        "ImageId": {
          "Ref": "SsmParameterValueawsserviceamiamazonlinuxlatestamzn2amihvmx8664gp2C96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "InstanceType": "t2.micro",
        "IamInstanceProfile": {
          "Ref": "asgBaselineInstanceProfile5B3EB932"
        },
        "KeyName": "ec2-key-pair",
        "SecurityGroups": [
          {
            "Fn::GetAtt": [
              "appsg42805CE6",
              "GroupId"
            ]
          },
          "sg-0fb189ccce05b883a"
        ],
        "UserData": {
          "Fn::Base64": {
            "Fn::Join": [
              "",
              [
                "#!/bin/bash\nmkdir -p $(dirname '/home/ec2-user/baseline.tar')\naws s3 cp 's3://",
                {
                  "Ref": "AssetParameters26270f87e4fba3388d4696223702390563a99b004ab38f55dba9f8cec53621c2S3Bucket396A38A3"
                },
                "/",
                {
                  "Fn::Select": [
                    0,
                    {
                      "Fn::Split": [
                        "||",
                        {
                          "Ref": "AssetParameters26270f87e4fba3388d4696223702390563a99b004ab38f55dba9f8cec53621c2S3VersionKey7D380BEA"
                        }
                      ]
                    }
                  ]
                },
                {
                  "Fn::Select": [
                    1,
                    {
                      "Fn::Split": [
                        "||",
                        {
                          "Ref": "AssetParameters26270f87e4fba3388d4696223702390563a99b004ab38f55dba9f8cec53621c2S3VersionKey7D380BEA"
                        }
                      ]
                    }
                  ]
                },
                "' '/home/ec2-user/baseline.tar'\nmkdir -p $(dirname '/home/ec2-user/docker-compose.yml')\naws s3 cp 's3://",
                {
                  "Ref": "AssetParametersd305dd11fd7f4cefbe4a1b6f8810fdc286483193cf7ef403efe1a4e5dda5846eS3Bucket7C54371C"
                },
                "/",
                {
                  "Fn::Select": [
                    0,
                    {
                      "Fn::Split": [
                        "||",
                        {
                          "Ref": "AssetParametersd305dd11fd7f4cefbe4a1b6f8810fdc286483193cf7ef403efe1a4e5dda5846eS3VersionKeyE364AF36"
                        }
                      ]
                    }
                  ]
                },
                {
                  "Fn::Select": [
                    1,
                    {
                      "Fn::Split": [
                        "||",
                        {
                          "Ref": "AssetParametersd305dd11fd7f4cefbe4a1b6f8810fdc286483193cf7ef403efe1a4e5dda5846eS3VersionKeyE364AF36"
                        }
                      ]
                    }
                  ]
                },
                "' '/home/ec2-user/docker-compose.yml'\n#!/bin/bash\n\n# system update\nyum update -y\n\n# install git\nyum install git\n\n# docker installation\namazon-linux-extras install docker\nservice docker start\nsystemctl enable docker\nusermod -a -G docker $USER\n\n# docker-compose installation\ncurl -L \"https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\nchmod +x /usr/local/bin/docker-compose\nln -s /usr/local/bin/docker-compose /usr/bin/docker-compose\n\n# download node_exporter\nuseradd -m -s /bin/bash prometheus\n\ncurl -L -O https://github.com/prometheus/node_exporter/releases/download/v1.2.2/node_exporter-1.2.2.linux-amd64.tar.gz\n\ntar -xzvf node_exporter-1.2.2.linux-amd64.tar.gz\nmv node_exporter-1.2.2.linux-amd64 /home/prometheus/node_exporter\nrm node_exporter-1.2.2.linux-amd64.tar.gz\nchown -R prometheus:prometheus /home/prometheus/node_exporter\n\n# Add node_exporter as systemd service\ntee -a /etc/systemd/system/node_exporter.service << END\n[Unit]\nDescription=Node Exporter\nWants=network-online.target\nAfter=network-online.target\n[Service]\nUser=prometheus\nExecStart=/home/prometheus/node_exporter/node_exporter\n[Install]\nWantedBy=default.target\nEND\n\nsystemctl daemon-reload\nsystemctl start node_exporter\nsystemctl enable node_exporter\n\n# setup demo app\n# yum install -y httpd\n# systemctl start httpd\n# systemctl enable httpd\n# echo \"<style> body {background-color: lightblue;} </style>\" > /var/www/html/index.html\n# echo \"<h1>Hello World from $(hostname -f) BASELINE instance 1</h1>\" >> /var/www/html/index.html\n\n\n\n# yum update -y\n# sudo su\n# \n# amazon-linux-extras install -y nginx1\n# systemctl start nginx\n# systemctl enable nginx\n# \n# chmod 2775 /usr/share/nginx/html\n# find /usr/share/nginx/html -type d -exec chmod 2775 {} \\;\n# find /usr/share/nginx/html -type f -exec chmod 0664 {} \\;\n# \n# echo \"<h1>Baseline</h1>\" > /usr/share/nginx/html/index.html\n\n\n# create a docker image from the tarball\ndocker load -i /home/ec2-user/baseline.tar\n\n# run the docker image\n# docker run -d -p 80:80 baseline\n\n# run docker-compose\ndocker-compose -f /home/ec2-user/docker-compose.yml up -d"
              ]
            ]
          }
        }
      },
      "DependsOn": [
        "asgBaselineInstanceRoleDefaultPolicyD58F3F8B",
        "asgBaselineInstanceRoleBAFF0850"
      ]
    },
    "asgBaselineASGAAFD1D57": {
      "Type": "AWS::AutoScaling::AutoScalingGroup",
      "Properties": {
        "MaxSize": "1",
        "MinSize": "1",
        "LaunchConfigurationName": {
          "Ref": "asgBaselineLaunchConfig3384BBEF"
        },
        "Tags": [
          {
            "Key": "Name",
            "PropagateAtLaunch": true,
            "Value": "aria-canary-Ingre-alb8A-FCLO2ZJVWR6C/asgBaseline"
          }
        ],
        "TargetGroupARNs": [
          {
            "Ref": "BASELINETARGETAF50761C"
          }
        ],
        "VPCZoneIdentifier": [
          "subnet-0bdd7dbe4e75ce9ac",
          "subnet-0f4c86ca42c638a27",
          "subnet-04023138e72c871f4"
        ]
      },
      "UpdatePolicy": {
        "AutoScalingScheduledAction": {
          "IgnoreUnmodifiedGroupSizeProperties": true
        }
      }
    },
    "asgCanaryInstanceRoleA9725CA5": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": {
                  "Fn::Join": [
                    "",
                    [
                      "ec2.",
                      {
                        "Ref": "AWS::URLSuffix"
                      }
                    ]
                  ]
                }
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Tags": [
          {
            "Key": "Name",
            "Value": "aria-canary-Ingre-alb8A-FCLO2ZJVWR6C/asgCanary"
          }
        ]
      }
    },
    "asgCanaryInstanceRoleDefaultPolicyAAE1B8D1": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":s3:::",
                      {
                        "Ref": "AssetParameters280f0b4501b2352d4d1d9769fc170daab1ff57c887a2aa9d9648d581a3c6cfa0S3Bucket52BD0A7C"
                      }
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":s3:::",
                      {
                        "Ref": "AssetParameters280f0b4501b2352d4d1d9769fc170daab1ff57c887a2aa9d9648d581a3c6cfa0S3Bucket52BD0A7C"
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":s3:::",
                      {
                        "Ref": "AssetParametersb848cedcf10dade5a4187c8572aca9b881cc70c83943ea31e0dc909496bacbbfS3Bucket49ADD16F"
                      }
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":s3:::",
                      {
                        "Ref": "AssetParametersb848cedcf10dade5a4187c8572aca9b881cc70c83943ea31e0dc909496bacbbfS3Bucket49ADD16F"
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "asgCanaryInstanceRoleDefaultPolicyAAE1B8D1",
        "Roles": [
          {
            "Ref": "asgCanaryInstanceRoleA9725CA5"
          }
        ]
      }
    },
    "asgCanaryInstanceProfile2D89516E": {
      "Type": "AWS::IAM::InstanceProfile",
      "Properties": {
        "Roles": [
          {
            "Ref": "asgCanaryInstanceRoleA9725CA5"
          }
        ]
      }
    },
    "asgCanaryLaunchConfigF5F72991": {
      "Type": "AWS::AutoScaling::LaunchConfiguration",
      "Properties": {
        "ImageId": {
          "Ref": "SsmParameterValueawsserviceamiamazonlinuxlatestamzn2amihvmx8664gp2C96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "InstanceType": "t2.micro",
        "IamInstanceProfile": {
          "Ref": "asgCanaryInstanceProfile2D89516E"
        },
        "KeyName": "ec2-key-pair",
        "SecurityGroups": [
          {
            "Fn::GetAtt": [
              "appsg42805CE6",
              "GroupId"
            ]
          },
          "sg-0fb189ccce05b883a"
        ],
        "UserData": {
          "Fn::Base64": {
            "Fn::Join": [
              "",
              [
                "#!/bin/bash\nmkdir -p $(dirname '/home/ec2-user/canary.tar')\naws s3 cp 's3://",
                {
                  "Ref": "AssetParameters280f0b4501b2352d4d1d9769fc170daab1ff57c887a2aa9d9648d581a3c6cfa0S3Bucket52BD0A7C"
                },
                "/",
                {
                  "Fn::Select": [
                    0,
                    {
                      "Fn::Split": [
                        "||",
                        {
                          "Ref": "AssetParameters280f0b4501b2352d4d1d9769fc170daab1ff57c887a2aa9d9648d581a3c6cfa0S3VersionKey5F81486B"
                        }
                      ]
                    }
                  ]
                },
                {
                  "Fn::Select": [
                    1,
                    {
                      "Fn::Split": [
                        "||",
                        {
                          "Ref": "AssetParameters280f0b4501b2352d4d1d9769fc170daab1ff57c887a2aa9d9648d581a3c6cfa0S3VersionKey5F81486B"
                        }
                      ]
                    }
                  ]
                },
                "' '/home/ec2-user/canary.tar'\nmkdir -p $(dirname '/home/ec2-user/docker-compose.yml')\naws s3 cp 's3://",
                {
                  "Ref": "AssetParametersb848cedcf10dade5a4187c8572aca9b881cc70c83943ea31e0dc909496bacbbfS3Bucket49ADD16F"
                },
                "/",
                {
                  "Fn::Select": [
                    0,
                    {
                      "Fn::Split": [
                        "||",
                        {
                          "Ref": "AssetParametersb848cedcf10dade5a4187c8572aca9b881cc70c83943ea31e0dc909496bacbbfS3VersionKey205059BF"
                        }
                      ]
                    }
                  ]
                },
                {
                  "Fn::Select": [
                    1,
                    {
                      "Fn::Split": [
                        "||",
                        {
                          "Ref": "AssetParametersb848cedcf10dade5a4187c8572aca9b881cc70c83943ea31e0dc909496bacbbfS3VersionKey205059BF"
                        }
                      ]
                    }
                  ]
                },
                "' '/home/ec2-user/docker-compose.yml'\n#!/bin/bash\n\n# system update\nyum update -y\n\n# install git\nyum install git\n\n# docker installation\namazon-linux-extras install docker\nservice docker start\nsystemctl enable docker\nusermod -a -G docker $USER\n\n# docker-compose installation\ncurl -L \"https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\nchmod +x /usr/local/bin/docker-compose\nln -s /usr/local/bin/docker-compose /usr/bin/docker-compose\n\n# download node_exporter\nuseradd -m -s /bin/bash prometheus\n\ncurl -L -O https://github.com/prometheus/node_exporter/releases/download/v1.2.2/node_exporter-1.2.2.linux-amd64.tar.gz\n\ntar -xzvf node_exporter-1.2.2.linux-amd64.tar.gz\nmv node_exporter-1.2.2.linux-amd64 /home/prometheus/node_exporter\nrm node_exporter-1.2.2.linux-amd64.tar.gz\nchown -R prometheus:prometheus /home/prometheus/node_exporter\n\n# Add node_exporter as systemd service\ntee -a /etc/systemd/system/node_exporter.service << END\n[Unit]\nDescription=Node Exporter\nWants=network-online.target\nAfter=network-online.target\n[Service]\nUser=prometheus\nExecStart=/home/prometheus/node_exporter/node_exporter\n[Install]\nWantedBy=default.target\nEND\n\nsystemctl daemon-reload\nsystemctl start node_exporter\nsystemctl enable node_exporter\n\n# setup demo app\n# yum install -y httpd\n# systemctl start httpd\n# systemctl enable httpd\n# echo \"<style> body {background-color: gold;} </style>\" > /var/www/html/index.html\n# echo \"<h1>Hello World from $(hostname -f) CANARY instance 1</h1>\" >> /var/www/html/index.html\n\n\n\n# yum update -y\n# sudo su\n# \n# amazon-linux-extras install -y nginx1\n# systemctl start nginx\n# systemctl enable nginx\n# \n# chmod 2775 /usr/share/nginx/html\n# find /usr/share/nginx/html -type d -exec chmod 2775 {} \\;\n# find /usr/share/nginx/html -type f -exec chmod 0664 {} \\;\n# \n# echo \"<h1>Canary</h1>\" > /usr/share/nginx/html/index.html\n\n# create a docker image from the tarball\ndocker load -i /home/ec2-user/canary.tar\n\n# run the docker image\n# docker run -d -p 80:80 canary\n\n# run docker-compose\ndocker-compose -f /home/ec2-user/docker-compose.yml up -d"
              ]
            ]
          }
        }
      },
      "DependsOn": [
        "asgCanaryInstanceRoleDefaultPolicyAAE1B8D1",
        "asgCanaryInstanceRoleA9725CA5"
      ]
    },
    "asgCanaryASGFA3929DF": {
      "Type": "AWS::AutoScaling::AutoScalingGroup",
      "Properties": {
        "MaxSize": "1",
        "MinSize": "1",
        "LaunchConfigurationName": {
          "Ref": "asgCanaryLaunchConfigF5F72991"
        },
        "Tags": [
          {
            "Key": "Name",
            "PropagateAtLaunch": true,
            "Value": "aria-canary-Ingre-alb8A-FCLO2ZJVWR6C/asgCanary"
          }
        ],
        "TargetGroupARNs": [
          {
            "Ref": "CANARYTARGET8CC1BC3F"
          }
        ],
        "VPCZoneIdentifier": [
          "subnet-0bdd7dbe4e75ce9ac",
          "subnet-0f4c86ca42c638a27",
          "subnet-04023138e72c871f4"
        ]
      },
      "UpdatePolicy": {
        "AutoScalingScheduledAction": {
          "IgnoreUnmodifiedGroupSizeProperties": true
        }
      }
    },
    "BASELINETARGETAF50761C": {
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
      "Properties": {
        "HealthCheckPath": "/",
        "Port": 80,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "false"
          }
        ],
        "TargetType": "instance",
        "VpcId": "vpc-03a574519fc5c939d"
      }
    },
    "CANARYTARGET8CC1BC3F": {
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
      "Properties": {
        "HealthCheckPath": "/",
        "Port": 80,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "false"
          }
        ],
        "TargetType": "instance",
        "VpcId": "vpc-03a574519fc5c939d"
      }
    },
    "monitorsg419B1E56": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "aria-canary-Ingre-alb8A-FCLO2ZJVWR6C/monitor-sg",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1"
          }
        ],
        "SecurityGroupIngress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "allow prometheus access",
            "FromPort": 9090,
            "IpProtocol": "tcp",
            "ToPort": 9090
          },
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "allow grafana access",
            "FromPort": 3000,
            "IpProtocol": "tcp",
            "ToPort": 3000
          },
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "allow kayenta access",
            "FromPort": 8090,
            "IpProtocol": "tcp",
            "ToPort": 8090
          },
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "allow referee access",
            "FromPort": 3001,
            "IpProtocol": "tcp",
            "ToPort": 3001
          },
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "allow SSH access from anywhere",
            "FromPort": 22,
            "IpProtocol": "tcp",
            "ToPort": 22
          }
        ],
        "VpcId": "vpc-03a574519fc5c939d"
      }
    },
    "monitorInstanceRole4CE258F3": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": {
                  "Fn::Join": [
                    "",
                    [
                      "ec2.",
                      {
                        "Ref": "AWS::URLSuffix"
                      }
                    ]
                  ]
                }
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Tags": [
          {
            "Key": "Name",
            "Value": "aria-canary-Ingre-alb8A-FCLO2ZJVWR6C/monitor"
          }
        ]
      }
    },
    "monitorInstanceRoleDefaultPolicy83E23CC0": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":s3:::",
                      {
                        "Ref": "AssetParameterse5ac1a0005d79cf7ac907b87d4f0c26b95c46554fbf9c3a7d54b7c8273a76017S3Bucket6E4F1D97"
                      }
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":s3:::",
                      {
                        "Ref": "AssetParameterse5ac1a0005d79cf7ac907b87d4f0c26b95c46554fbf9c3a7d54b7c8273a76017S3Bucket6E4F1D97"
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":s3:::",
                      {
                        "Ref": "AssetParametersc09279741911c3f98f889d3aafc8dc0ac8ab07f38f6060e8b20f882de007a1f1S3Bucket80012A2A"
                      }
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":s3:::",
                      {
                        "Ref": "AssetParametersc09279741911c3f98f889d3aafc8dc0ac8ab07f38f6060e8b20f882de007a1f1S3Bucket80012A2A"
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":s3:::",
                      {
                        "Ref": "AssetParameters72ee5086766f1dced3b2d279bb06b46c3aa9b8e7391764f0b6569fe6cb643bf2S3Bucket23BBFD6D"
                      }
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":s3:::",
                      {
                        "Ref": "AssetParameters72ee5086766f1dced3b2d279bb06b46c3aa9b8e7391764f0b6569fe6cb643bf2S3Bucket23BBFD6D"
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "monitorInstanceRoleDefaultPolicy83E23CC0",
        "Roles": [
          {
            "Ref": "monitorInstanceRole4CE258F3"
          }
        ]
      }
    },
    "monitorInstanceProfile6E9B6855": {
      "Type": "AWS::IAM::InstanceProfile",
      "Properties": {
        "Roles": [
          {
            "Ref": "monitorInstanceRole4CE258F3"
          }
        ]
      }
    },
    "monitor360B0AD7": {
      "Type": "AWS::EC2::Instance",
      "Properties": {
        "AvailabilityZone": "us-west-2a",
        "IamInstanceProfile": {
          "Ref": "monitorInstanceProfile6E9B6855"
        },
        "ImageId": {
          "Ref": "SsmParameterValueawsserviceamiamazonlinuxlatestamzn2amihvmx8664gp2C96584B6F00A464EAD1953AFF4B05118Parameter"
        },
        "InstanceType": "t2.medium",
        "KeyName": "ec2-key-pair",
        "SecurityGroupIds": [
          {
            "Fn::GetAtt": [
              "monitorsg419B1E56",
              "GroupId"
            ]
          }
        ],
        "SubnetId": "subnet-0bdd7dbe4e75ce9ac",
        "Tags": [
          {
            "Key": "Name",
            "Value": "aria-canary-Ingre-alb8A-FCLO2ZJVWR6C/monitor"
          }
        ],
        "UserData": {
          "Fn::Base64": {
            "Fn::Join": [
              "",
              [
                "#!/bin/bash\nmkdir -p $(dirname '/home/ec2-user/docker-compose.yml')\naws s3 cp 's3://",
                {
                  "Ref": "AssetParameterse5ac1a0005d79cf7ac907b87d4f0c26b95c46554fbf9c3a7d54b7c8273a76017S3Bucket6E4F1D97"
                },
                "/",
                {
                  "Fn::Select": [
                    0,
                    {
                      "Fn::Split": [
                        "||",
                        {
                          "Ref": "AssetParameterse5ac1a0005d79cf7ac907b87d4f0c26b95c46554fbf9c3a7d54b7c8273a76017S3VersionKeyA709E6C5"
                        }
                      ]
                    }
                  ]
                },
                {
                  "Fn::Select": [
                    1,
                    {
                      "Fn::Split": [
                        "||",
                        {
                          "Ref": "AssetParameterse5ac1a0005d79cf7ac907b87d4f0c26b95c46554fbf9c3a7d54b7c8273a76017S3VersionKeyA709E6C5"
                        }
                      ]
                    }
                  ]
                },
                "' '/home/ec2-user/docker-compose.yml'\nmkdir -p $(dirname '/home/ec2-user/kayenta.yml')\naws s3 cp 's3://",
                {
                  "Ref": "AssetParametersc09279741911c3f98f889d3aafc8dc0ac8ab07f38f6060e8b20f882de007a1f1S3Bucket80012A2A"
                },
                "/",
                {
                  "Fn::Select": [
                    0,
                    {
                      "Fn::Split": [
                        "||",
                        {
                          "Ref": "AssetParametersc09279741911c3f98f889d3aafc8dc0ac8ab07f38f6060e8b20f882de007a1f1S3VersionKey250699AA"
                        }
                      ]
                    }
                  ]
                },
                {
                  "Fn::Select": [
                    1,
                    {
                      "Fn::Split": [
                        "||",
                        {
                          "Ref": "AssetParametersc09279741911c3f98f889d3aafc8dc0ac8ab07f38f6060e8b20f882de007a1f1S3VersionKey250699AA"
                        }
                      ]
                    }
                  ]
                },
                "' '/home/ec2-user/kayenta.yml'\nmkdir -p $(dirname '/home/ec2-user/prometheus.yml')\naws s3 cp 's3://",
                {
                  "Ref": "AssetParameters72ee5086766f1dced3b2d279bb06b46c3aa9b8e7391764f0b6569fe6cb643bf2S3Bucket23BBFD6D"
                },
                "/",
                {
                  "Fn::Select": [
                    0,
                    {
                      "Fn::Split": [
                        "||",
                        {
                          "Ref": "AssetParameters72ee5086766f1dced3b2d279bb06b46c3aa9b8e7391764f0b6569fe6cb643bf2S3VersionKey4DFCFC74"
                        }
                      ]
                    }
                  ]
                },
                {
                  "Fn::Select": [
                    1,
                    {
                      "Fn::Split": [
                        "||",
                        {
                          "Ref": "AssetParameters72ee5086766f1dced3b2d279bb06b46c3aa9b8e7391764f0b6569fe6cb643bf2S3VersionKey4DFCFC74"
                        }
                      ]
                    }
                  ]
                },
                "' '/home/ec2-user/prometheus.yml'\n#!/bin/bash\n\n# update\nyum update -y\n\n# install git\nyum install git\n\n# docker installation\namazon-linux-extras install docker\nservice docker start\nsystemctl enable docker\nusermod -a -G docker ec2-user\n\n# docker-compose installation\ncurl -L \"https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\nchmod +x /usr/local/bin/docker-compose\nln -s /usr/local/bin/docker-compose /usr/bin/docker-compose\n\n# move to home directory so config files land there\ncd /home/ec2-user\n\n# change ownership of all files in home directory to ec2-user\nchown -R ec2-user:ec2-user .\n\n# bring up containers for monitoring/analysis\ndocker-compose up\n"
              ]
            ]
          }
        }
      },
      "DependsOn": [
        "monitorInstanceRoleDefaultPolicy83E23CC0",
        "monitorInstanceRole4CE258F3"
      ]
    }
  },
  "Parameters": {
    "AssetParameters280f0b4501b2352d4d1d9769fc170daab1ff57c887a2aa9d9648d581a3c6cfa0S3Bucket52BD0A7C": {
      "Type": "String",
      "Description": "S3 bucket for asset \"280f0b4501b2352d4d1d9769fc170daab1ff57c887a2aa9d9648d581a3c6cfa0\""
    },
    "AssetParameters280f0b4501b2352d4d1d9769fc170daab1ff57c887a2aa9d9648d581a3c6cfa0S3VersionKey5F81486B": {
      "Type": "String",
      "Description": "S3 key for asset version \"280f0b4501b2352d4d1d9769fc170daab1ff57c887a2aa9d9648d581a3c6cfa0\""
    },
    "AssetParameters280f0b4501b2352d4d1d9769fc170daab1ff57c887a2aa9d9648d581a3c6cfa0ArtifactHashE4534E49": {
      "Type": "String",
      "Description": "Artifact hash for asset \"280f0b4501b2352d4d1d9769fc170daab1ff57c887a2aa9d9648d581a3c6cfa0\""
    },
    "AssetParametersb848cedcf10dade5a4187c8572aca9b881cc70c83943ea31e0dc909496bacbbfS3Bucket49ADD16F": {
      "Type": "String",
      "Description": "S3 bucket for asset \"b848cedcf10dade5a4187c8572aca9b881cc70c83943ea31e0dc909496bacbbf\""
    },
    "AssetParametersb848cedcf10dade5a4187c8572aca9b881cc70c83943ea31e0dc909496bacbbfS3VersionKey205059BF": {
      "Type": "String",
      "Description": "S3 key for asset version \"b848cedcf10dade5a4187c8572aca9b881cc70c83943ea31e0dc909496bacbbf\""
    },
    "AssetParametersb848cedcf10dade5a4187c8572aca9b881cc70c83943ea31e0dc909496bacbbfArtifactHash5AC115EA": {
      "Type": "String",
      "Description": "Artifact hash for asset \"b848cedcf10dade5a4187c8572aca9b881cc70c83943ea31e0dc909496bacbbf\""
    },
    "AssetParameters26270f87e4fba3388d4696223702390563a99b004ab38f55dba9f8cec53621c2S3Bucket396A38A3": {
      "Type": "String",
      "Description": "S3 bucket for asset \"26270f87e4fba3388d4696223702390563a99b004ab38f55dba9f8cec53621c2\""
    },
    "AssetParameters26270f87e4fba3388d4696223702390563a99b004ab38f55dba9f8cec53621c2S3VersionKey7D380BEA": {
      "Type": "String",
      "Description": "S3 key for asset version \"26270f87e4fba3388d4696223702390563a99b004ab38f55dba9f8cec53621c2\""
    },
    "AssetParameters26270f87e4fba3388d4696223702390563a99b004ab38f55dba9f8cec53621c2ArtifactHash17F0F16D": {
      "Type": "String",
      "Description": "Artifact hash for asset \"26270f87e4fba3388d4696223702390563a99b004ab38f55dba9f8cec53621c2\""
    },
    "AssetParametersd305dd11fd7f4cefbe4a1b6f8810fdc286483193cf7ef403efe1a4e5dda5846eS3Bucket7C54371C": {
      "Type": "String",
      "Description": "S3 bucket for asset \"d305dd11fd7f4cefbe4a1b6f8810fdc286483193cf7ef403efe1a4e5dda5846e\""
    },
    "AssetParametersd305dd11fd7f4cefbe4a1b6f8810fdc286483193cf7ef403efe1a4e5dda5846eS3VersionKeyE364AF36": {
      "Type": "String",
      "Description": "S3 key for asset version \"d305dd11fd7f4cefbe4a1b6f8810fdc286483193cf7ef403efe1a4e5dda5846e\""
    },
    "AssetParametersd305dd11fd7f4cefbe4a1b6f8810fdc286483193cf7ef403efe1a4e5dda5846eArtifactHashF96C491F": {
      "Type": "String",
      "Description": "Artifact hash for asset \"d305dd11fd7f4cefbe4a1b6f8810fdc286483193cf7ef403efe1a4e5dda5846e\""
    },
    "AssetParameterse5ac1a0005d79cf7ac907b87d4f0c26b95c46554fbf9c3a7d54b7c8273a76017S3Bucket6E4F1D97": {
      "Type": "String",
      "Description": "S3 bucket for asset \"e5ac1a0005d79cf7ac907b87d4f0c26b95c46554fbf9c3a7d54b7c8273a76017\""
    },
    "AssetParameterse5ac1a0005d79cf7ac907b87d4f0c26b95c46554fbf9c3a7d54b7c8273a76017S3VersionKeyA709E6C5": {
      "Type": "String",
      "Description": "S3 key for asset version \"e5ac1a0005d79cf7ac907b87d4f0c26b95c46554fbf9c3a7d54b7c8273a76017\""
    },
    "AssetParameterse5ac1a0005d79cf7ac907b87d4f0c26b95c46554fbf9c3a7d54b7c8273a76017ArtifactHashC70C78AD": {
      "Type": "String",
      "Description": "Artifact hash for asset \"e5ac1a0005d79cf7ac907b87d4f0c26b95c46554fbf9c3a7d54b7c8273a76017\""
    },
    "AssetParametersc09279741911c3f98f889d3aafc8dc0ac8ab07f38f6060e8b20f882de007a1f1S3Bucket80012A2A": {
      "Type": "String",
      "Description": "S3 bucket for asset \"c09279741911c3f98f889d3aafc8dc0ac8ab07f38f6060e8b20f882de007a1f1\""
    },
    "AssetParametersc09279741911c3f98f889d3aafc8dc0ac8ab07f38f6060e8b20f882de007a1f1S3VersionKey250699AA": {
      "Type": "String",
      "Description": "S3 key for asset version \"c09279741911c3f98f889d3aafc8dc0ac8ab07f38f6060e8b20f882de007a1f1\""
    },
    "AssetParametersc09279741911c3f98f889d3aafc8dc0ac8ab07f38f6060e8b20f882de007a1f1ArtifactHash5A1AB47A": {
      "Type": "String",
      "Description": "Artifact hash for asset \"c09279741911c3f98f889d3aafc8dc0ac8ab07f38f6060e8b20f882de007a1f1\""
    },
    "AssetParameters72ee5086766f1dced3b2d279bb06b46c3aa9b8e7391764f0b6569fe6cb643bf2S3Bucket23BBFD6D": {
      "Type": "String",
      "Description": "S3 bucket for asset \"72ee5086766f1dced3b2d279bb06b46c3aa9b8e7391764f0b6569fe6cb643bf2\""
    },
    "AssetParameters72ee5086766f1dced3b2d279bb06b46c3aa9b8e7391764f0b6569fe6cb643bf2S3VersionKey4DFCFC74": {
      "Type": "String",
      "Description": "S3 key for asset version \"72ee5086766f1dced3b2d279bb06b46c3aa9b8e7391764f0b6569fe6cb643bf2\""
    },
    "AssetParameters72ee5086766f1dced3b2d279bb06b46c3aa9b8e7391764f0b6569fe6cb643bf2ArtifactHash91C155AE": {
      "Type": "String",
      "Description": "Artifact hash for asset \"72ee5086766f1dced3b2d279bb06b46c3aa9b8e7391764f0b6569fe6cb643bf2\""
    },
    "SsmParameterValueawsserviceamiamazonlinuxlatestamzn2amihvmx8664gp2C96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Type": "AWS::SSM::Parameter::Value<AWS::EC2::Image::Id>",
      "Default": "/aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2"
    }
  },
  "Outputs": {
    "ariacanary": {
      "Value": "true"
    },
    "ariaconfig": {
      "Value": "{\"profileName\":\"default\",\"stackName\":\"Test Stack Canary Deployment\",\"stackDescription\":\"Test Stack Canary Deployment\",\"keyPair\":\"ec2-key-pair\",\"selectedAlbName\":\"Ingre-alb8A-FCLO2ZJVWR6C\",\"selectedAlbArn\":\"arn:aws:elasticloadbalancing:us-west-2:750078097588:loadbalancer/app/Ingre-alb8A-FCLO2ZJVWR6C/5c0b1f50cd4bf962\",\"selectedListenerArn\":\"arn:aws:elasticloadbalancing:us-west-2:750078097588:listener/app/Ingre-alb8A-FCLO2ZJVWR6C/5c0b1f50cd4bf962/2a57f1ccae3cb145\",\"selectedPort\":80,\"TargetGroupArn\":\"arn:aws:elasticloadbalancing:us-west-2:750078097588:targetgroup/Ingre-albLi-9W3QKA9Y1H1A/8582dbca80b9ab99\",\"vpcId\":\"vpc-03a574519fc5c939d\",\"securityGroupIds\":[{\"groupId\":\"sg-0fb189ccce05b883a\"}],\"isStickySesssion\":false,\"priority\":1,\"weight\":10,\"conditions\":[{\"Field\":\"path-pattern\",\"PathPatternConfig\":{\"Values\":[\"/\"]}}],\"canaryImgPath\":\"canary.tar\",\"baselineImgPath\":\"baseline.tar\",\"canaryComposePath\":\"docker-compose-canary.yml\",\"baselineComposePath\":\"docker-compose-baseline.yml\",\"exporters\":[],\"healthCheckPath\":\"/\",\"newRuleConfig\":{\"Actions\":[{\"Type\":\"forward\",\"ForwardConfig\":{\"TargetGroupStickinessConfig\":{},\"TargetGroups\":[{\"TargetGroupArn\":\"arn:aws:elasticloadbalancing:us-west-2:750078097588:targetgroup/Ingre-albLi-9W3QKA9Y1H1A/8582dbca80b9ab99\",\"Weight\":180},{\"TargetGroupArn\":\"Insert Canary Target ARN\",\"Weight\":10},{\"TargetGroupArn\":\"Insert Baseline Target ARN\",\"Weight\":10}]}}],\"Conditions\":[{\"Field\":\"path-pattern\",\"PathPatternConfig\":{\"Values\":[\"/\"]}}],\"ListenerArn\":\"arn:aws:elasticloadbalancing:us-west-2:750078097588:listener/app/Ingre-alb8A-FCLO2ZJVWR6C/5c0b1f50cd4bf962/2a57f1ccae3cb145\",\"Priority\":1,\"Tags\":[{\"Key\":\"isAriaCanaryRule\",\"Value\":\"Ingre-alb8A-FCLO2ZJVWR6C\"}]},\"vpcConfig\":{\"vpcId\":\"vpc-03a574519fc5c939d\",\"availabilityZones\":[\"us-west-2a\",\"us-west-2b\",\"us-west-2c\"],\"publicSubnetIds\":[\"subnet-0bdd7dbe4e75ce9ac\",\"subnet-0f4c86ca42c638a27\",\"subnet-04023138e72c871f4\"],\"privateSubnetIds\":[\"subnet-0af19ef5a49999f43\",\"subnet-05abe8e5faf801f07\",\"subnet-08753d5f759998a43\"]},\"credentials\":{}}"
    },
    "BaselineTargetGroupArn": {
      "Value": {
        "Ref": "BASELINETARGETAF50761C"
      }
    },
    "CanaryTargetGroupArn": {
      "Value": {
        "Ref": "CANARYTARGET8CC1BC3F"
      }
    },
    "prometheusDNS": {
      "Value": {
        "Fn::Join": [
          "",
          [
            "http://",
            {
              "Fn::GetAtt": [
                "monitor360B0AD7",
                "PublicDnsName"
              ]
            },
            ":9090"
          ]
        ]
      }
    },
    "monitorId": {
      "Value": {
        "Ref": "monitor360B0AD7"
      }
    },
    "grafanaDNS": {
      "Value": {
        "Fn::Join": [
          "",
          [
            "http://",
            {
              "Fn::GetAtt": [
                "monitor360B0AD7",
                "PublicDnsName"
              ]
            },
            ":3000"
          ]
        ]
      }
    },
    "kayentaDNS": {
      "Value": {
        "Fn::Join": [
          "",
          [
            "http://",
            {
              "Fn::GetAtt": [
                "monitor360B0AD7",
                "PublicDnsName"
              ]
            },
            ":8090/swagger-ui.html"
          ]
        ]
      }
    },
    "refereeDNS": {
      "Value": {
        "Fn::Join": [
          "",
          [
            "http://",
            {
              "Fn::GetAtt": [
                "monitor360B0AD7",
                "PublicDnsName"
              ]
            },
            ":3001"
          ]
        ]
      }
    }
  }
}